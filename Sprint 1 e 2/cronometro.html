<!-- cronometro.html -->
<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cron√¥metro</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">

        <div class="header">
            <h1>Cron√¥metro</h1>
            <div class="profile">
                <svg width="50" height="50" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M12.1875 35.625C13.9584 34.2708 15.9375 33.2031 18.125 32.4218C20.3125 31.6406 22.6042 31.25 25 31.25C27.3959 31.25 29.6875 31.6406 31.875 32.4218C34.0625 33.2031 36.0417 34.2708 37.8125 35.625C39.0278 34.2013 39.974 32.5868 40.6511 30.7812C41.3281 28.9757 41.6667 27.0486 41.6667 25C41.6667 20.3819 40.0434 16.4496 36.7969 13.2031C33.5504 9.95656 29.6181 8.33329 25 8.33329C20.382 8.33329 16.4497 9.95656 13.2031 13.2031C9.95662 16.4496 8.33335 20.3819 8.33335 25C8.33335 27.0486 8.6719 28.9757 9.34898 30.7812C10.0261 32.5868 10.9722 34.2013 12.1875 35.625ZM25 27.0833C22.9514 27.0833 21.224 26.3802 19.8177 24.9739C18.4115 23.5677 17.7084 21.8402 17.7084 19.7916C17.7084 17.743 18.4115 16.0156 19.8177 14.6093C21.224 13.2031 22.9514 12.5 25 12.5C27.0486 12.5 28.7761 13.2031 30.1823 14.6093C31.5886 16.0156 32.2917 17.743 32.2917 19.7916C32.2917 21.8402 31.5886 23.5677 30.1823 24.9739C28.7761 26.3802 27.0486 27.0833 25 27.0833ZM25 45.8333C22.1181 45.8333 19.4097 45.2864 16.875 44.1927C14.3403 43.0989 12.1354 41.6145 10.2604 39.7395C8.38544 37.8645 6.90106 35.6597 5.80731 33.125C4.71356 30.5902 4.16669 27.8819 4.16669 25C4.16669 22.118 4.71356 19.4097 5.80731 16.875C6.90106 14.3402 8.38544 12.1354 10.2604 10.2604C12.1354 8.38538 14.3403 6.901 16.875 5.80725C19.4097 4.7135 22.1181 4.16663 25 4.16663C27.882 4.16663 30.5903 4.7135 33.125 5.80725C35.6597 6.901 37.8646 8.38538 39.7396 10.2604C41.6146 12.1354 43.099 14.3402 44.1927 16.875C45.2865 19.4097 45.8334 22.118 45.8334 25C45.8334 27.8819 45.2865 30.5902 44.1927 33.125C43.099 35.6597 41.6146 37.8645 39.7396 39.7395C37.8646 41.6145 35.6597 43.0989 33.125 44.1927C30.5903 45.2864 27.882 45.8333 25 45.8333Z"
                        fill="#01458E" />
                </svg>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M12 20C11.45 20 10.9792 19.8042 10.5875 19.4125C10.1958 19.0208 10 18.55 10 18C10 17.45 10.1958 16.9792 10.5875 16.5875C10.9792 16.1958 11.45 16 12 16C12.55 16 13.0208 16.1958 13.4125 16.5875C13.8042 16.9792 14 17.45 14 18C14 18.55 13.8042 19.0208 13.4125 19.4125C13.0208 19.8042 12.55 20 12 20ZM12 14C11.45 14 10.9792 13.8042 10.5875 13.4125C10.1958 13.0208 10 12.55 10 12C10 11.45 10.1958 10.9792 10.5875 10.5875C10.9792 10.1958 11.45 10 12 10C12.55 10 13.0208 10.1958 13.4125 10.5875C13.8042 10.9792 14 11.45 14 12C14 12.55 13.8042 13.0208 13.4125 13.4125C13.0208 13.8042 12.55 14 12 14ZM12 8C11.45 8 10.9792 7.80417 10.5875 7.4125C10.1958 7.02083 10 6.55 10 6C10 5.45 10.1958 4.97917 10.5875 4.5875C10.9792 4.19583 11.45 4 12 4C12.55 4 13.0208 4.19583 13.4125 4.5875C13.8042 4.97917 14 5.45 14 6C14 6.55 13.8042 7.02083 13.4125 7.4125C13.0208 7.80417 12.55 8 12 8Z"
                        fill="#1D1B20" />
                </svg>

            </div>
        </div>

        <div class="mostra cronometro" id="activity-list">
            <!-- Activities created will appear here -->
        </div>

        <div class="criar">
            <a href="criarcronometro.html">+</a>
        </div>

        <div class="nav-bar">
            <a href="cronometro.html" class="nav-item" data-tab="cronometro">
                <div class="icon-wrapper">
                    <img src="cronometro.png" alt="√çcone cron√¥metro" />
                </div>
                <span>Cron√¥metro</span>
            </a>
            <a href="metas.html" class="nav-item" data-tab="metas">
                <div class="icon-wrapper">
                    <img src="alvo.png" alt="√çcone metas" />
                </div>
                <span>Metas</span>
            </a>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const list = document.getElementById("activity-list");
            const activities = JSON.parse(localStorage.getItem("activities")) || [];

            activities.forEach((activity, index) => {
                const div = document.createElement("div");
                div.className = "cronometro-card";

                const userColor = activity.color || "#1d3fa1";
                div.style.background = `linear-gradient(135deg, black, ${userColor})`;

                const totalSeconds = activity.totalSeconds ?? 0;
                const elapsed = activity.elapsed ?? 0;
                const remaining = totalSeconds - elapsed;
                const progress = Math.min((elapsed / totalSeconds) * 100, 100);
                const circleLength = 2 * Math.PI * 30;

                div.innerHTML = `
        <div class="cronometro-top">
          <span class="titulo">${activity.name}</span>
          <span class="tempo-passado" id="elapsed-${index}">${formatSimpleTime(elapsed)}</span>
        </div>

        <div class="grafico-e-tempo">
          <svg class="progress-ring" width="70" height="70">
            <circle class="ring-bg" r="30" cx="35" cy="35" fill="transparent" stroke="#444" stroke-width="10" />
            <circle class="ring" id="ring-${index}" r="30" cx="35" cy="35" fill="transparent" stroke="#fff" stroke-width="10"
              stroke-dasharray="${circleLength}" stroke-dashoffset="${circleLength * (1 - progress / 100)}" />
          </svg>
        </div>

        <div class="botoes">
          <span class="tempo" id="timer-${index}">${formatTime(remaining)}</span>
          <button class="play" id="play-${index}" onclick="startTimer(${index})"><svg width="49" height="43" viewBox="0 0 49 43" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.3334 34.0417V8.95837L38.7917 21.5L16.3334 34.0417Z" fill="url(#paint0_linear_223_711)"/><defs><linearGradient id="paint0_linear_223_711" x1="27.5625" y1="8.95837" x2="27.5625" y2="34.0417" gradientUnits="userSpaceOnUse"><stop stop-color="#12FF12"/><stop offset="1" stop-color="#0B990B"/></linearGradient></defs></svg>
</button>
          <button class="stop" id="stop-${index}" onclick="stopTimer(${index})" style="display: none;">‚è∏Ô∏è</button>
          <button onclick="deleteActivity(${index})">üóëÔ∏è</button>
        </div>
      `;

                list.appendChild(div);
            });
        });

        const timers = {};

        function formatTime(seconds) {
            const hrs = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${String(hrs).padStart(2, '0')}h ${String(mins).padStart(2, '0')}m ${String(secs).padStart(2, '0')}s`;
        }

        function formatSimpleTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        function startTimer(index) {
            const activities = JSON.parse(localStorage.getItem("activities"));
            let activity = activities[index];

            if (timers[index]) return;

            if (!activity.elapsed) activity.elapsed = 0;
            const totalSeconds = activity.totalSeconds ?? 0;

            const timerSpan = document.getElementById(`timer-${index}`);
            const elapsedSpan = document.getElementById(`elapsed-${index}`);
            const ring = document.getElementById(`ring-${index}`);
            const circleLength = 2 * Math.PI * 30;

            // alterna bot√µes
            document.getElementById(`play-${index}`).style.display = "none";
            document.getElementById(`stop-${index}`).style.display = "inline-block";

            timers[index] = setInterval(() => {
                if (activity.elapsed < totalSeconds) {
                    activity.elapsed++;
                    const remaining = totalSeconds - activity.elapsed;
                    const progress = Math.min((activity.elapsed / totalSeconds) * 100, 100);

                    timerSpan.textContent = formatTime(remaining);
                    elapsedSpan.textContent = formatSimpleTime(activity.elapsed);
                    ring.style.strokeDashoffset = circleLength * (1 - progress / 100);

                    activities[index] = activity;
                    localStorage.setItem("activities", JSON.stringify(activities));
                } else {
                    clearInterval(timers[index]);
                    timers[index] = null;
                    document.getElementById(`play-${index}`).style.display = "inline-block";
                    document.getElementById(`stop-${index}`).style.display = "none";
                }
            }, 1000);
        }

        function stopTimer(index) {
            clearInterval(timers[index]);
            timers[index] = null;

            document.getElementById(`play-${index}`).style.display = "inline-block";
            document.getElementById(`stop-${index}`).style.display = "none";
        }

        function deleteActivity(index) {
            const activities = JSON.parse(localStorage.getItem("activities"));
            activities.splice(index, 1);
            localStorage.setItem("activities", JSON.stringify(activities));
            location.reload();
        }
    </script>


</body>

</html>